# Security


## XSSと出力エンコーディング
* XSSとは、不正なスクリプト(基本的にJavaScript)をページ内に仕込む攻撃
* 対策として、ページ上に出力する変数値を全て無害な文字列にエンコードする


## SQLインジェクション
* リクエストから受け取った値をそのままSQLクエリに利用した場合などに、SQLクエリ内に不正なクエリを仕込むことができる
* このような不正なSQLクエリを実行させる攻撃をSQLインジェクションと呼ぶ
* 対策として、SQLクエリに渡される変数値をすべて無害な文字列にエンコードする


## CSRF
* 対策をしていないと自サイトではない他のサイトのフォームからも、自サイトのアドレスを指定されていればPOSTなどのリクエストが行えてしまう
* また、クッキーなどでログイン管理していても、自サイトへの投稿は自サイト用のクッキーが扱われるので、 クッキーにログイン情報が残っている場合、投稿できてしまう
* このような不正なフォームなどからのリクエストをCSRF(クロスサイト・リクエスト・フォージェリ)と言う
* 自サイトのフォームにトークンを仕込むことで、自サイトのフォーム以外からの不正なリクエストを受け付けないようにできる


## Session
* Sessionは、ユーザごとにキーバリューの値を保存して扱うためのもの
* ユーザのログイン情報管理などに利用されることが多い
* CookieにセッションIDを暗号化して保存しておき、サーバサイドでもセッションIDに紐ずくユーザ・ログイン情報などを保存しておく
* ユーザから送られてくるサーバはCookieを見て、ログイン済みなら専用ページを見せたり、ログインしてないならログインページへリダイレクトしたりする


## Cookie
* secure属性: HTTPS上での通信でのみCookieを扱うようになる
* httponly属性: JavaScriptから読み書きさせない
* [GOOGLE が使用している COOKIE の種類](https://policies.google.com/technologies/types?hl=ja)
    * 設定
        * NIDというIDを保存し、このIDにユーザの設定情報(言語情報、位置情報、検索エンジンの設定など)が紐図いている
    * セッション管理
        * SID、HSIDという名前に、アカウントIDや直近のログイン時刻などの情報がCookie上に暗号化されて保存されている
    * プロセス状態、セッション状態の管理
        * Googleドキュメントの複数タブでの同時利用や、Youtubeでの直近再生情報などの状態管理に利用している
    * 広告、アナリスティクス
        * ユーザ行動から関連広告を見せるような仕組みがある
        * __gaというキーでIDを保存しており、匿名で利用動向を把握し解析するために利用される


## HTTP Headers
* Host
    * ResuestのHostヘッダ(ユーザがどのドメインでアクセスしてきたか)を見て、予期しないホストでのアクセスを防ぐ
* X-Frame-Options: DENY
    * DENYに設定しておくと
* X-Content-Type-Options: nosniff
    * ブラウザがファイルを取得したときに、Content-Typeの指定がない場合、ブラウザは自動でそのTypeを判定して処理しようとする
    * ドライブバイダウンロード攻撃の軽減対策になる
        * ウェブページなどを改ざんし、マルウェアなどの悪意あるコードをダウンロードさせて感染させる攻撃
* X-XSS-Protectiona: 1; mode=block
    * ブラウザがXSS攻撃が検出したときに、レンダリングをやめる
