# OS Install

## MBRとGPT

MBR（Master Boot Record）とGPT（GUID Partition Table）は、ディスクのパーティション方式の種類です。

MBRは古い方式で、最大2TBのディスクサイズをサポートし、最大4つのプライマリパーティションを持つことができます。

MBR方式は、BIOSベースのシステムで使用され、UEFIではサポートされていません。

一方GPTは新しい方式で、より大きなディスクサイズ（最大9.4ZB）をサポートし、理論上は無制限のパーティションを持つことができます。

GPTはUEFIベースのシステムで使用されています。

### MBR

MBR方式は、以下のディスク構成をとります。

- MBR
  - ディスクの先頭512バイトの領域
  - ブートローダーのコード(先頭の446バイト)
    - OSの起動に必要な最低限のコードが含まれます。
  - パーティションテーブル1（次の16バイト）
  - パーティションテーブル2（次の16バイト）
  - パーティションテーブル3（次の16バイト）
  - パーティションテーブル4（次の16バイト）
  - ブートシグネチャ（最後の2バイト）
    - 固定値(0xAA55)が含まれ、MBRが正しいことを示します。
    - このシグネチャがない場合、BIOSはMBRを無効とみなします。
- プライマリパーティション1
- プライマリパーティション2
- プライマリパーティション3
- プライマリパーティション4

プライマリパーティション1には、通常OSがインストールされています。

BIOSは、有効なMBRを検出すると、ブートローダーのコードを実行し、OSを起動します。

### GPT

GPTは、以下のディスク構成をとります。

GPTはLogical Block Addressing(LBA)を使ってディスク内の位置を示します。

- LBA 0: Protective MBR
  - ディスクの先頭512バイトの領域
  - GPTをサポートしない古いシステムとの互換性のためにMBRと同様に512バイトのセクターを持ちます。
- LBA 1-33: Primary GPT
  - LBA 1: Primary GPT Header
    - ユーザが使用可能なディスクの範囲、パーティションテーブル内のパーティションエントリ数とサイズを定義している
  - LBA 2-33: Primary Partition Table
    - 最初の16バイトにパーティションの種類を示すGUIDが含まれ、次の8バイトにパーティションの最初のLBA、次の8バイトにパーティションの最後のLBA、次の8バイトにパーティションの属性が含まれます。
- LBA 34-N
  - Partition 1
  - Partition 2
  - Partition X
- LBA N+1(-34): Secondary GPT
  - LBA -33: Secondary Partition Table
    - Primary Partition Tableのバックアップデータ
  - LBA -1: Secondary GPT Header
    - Primary GPT Headerのバックアップデータ
