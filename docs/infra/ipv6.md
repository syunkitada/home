# IPv6

## 概要

- IPv4 と IPv6 は別物で互換性はなく、IPv6 対応とは両者デュアルスタック環境で運用するということ
- DNS が IPv4 と IPv6 を返した場合にクライアントはどちらのプロトコルを使うかを選択する

## IPv6 基本プロトコル

- アドレスの種類
  - ユニキャストアドレス
    - 単一インタフェースの識別子
    - ユニキャストアドレス宛のパケットは、そのアドレスをもつインタフェースに配送される
  - エニーキャストアドレス
    - インタフェースの集合の識別子で、複数の機器に付与される
    - エニーキャストアドレス宛のパケットは、そのアドレスを持つ「一番近くにある」機器のインタフェースに配送される
    - エニーキャストアドレスは、ユニキャストアドレス空間から割り当てられるので、表記上、エニーキャストアドレスとユニキャストアドレスの区別はつかない
  - マルチキャストアドレス
    - インタフェースの集合の識別子で、複数の機器に付与される
    - マルチキャストアドレス宛のパケットは、そのアドレスをもつすべてのインタフェースに配送される
    - IPv6 には、IPv4 にあったブロードキャストアドレスが存在せず、マルチキャストアドレスが同様の役割を果たす
- アドレスの型
  - IPv6 では、上位ビットにより、未指定アドレス、ループバックアドレス、マルチキャストアドレス、リンクローカルユニキャストアドレス、グローバルユニキャストアドレスに分類される
- アドレスの表記法
  - IPv4 アドレスは、32 ビットを 8 ビットずつ 4 つに"." (ピリオド)で区切った数値列を、"192.168.0.1" のように 10 進数で記述している
  - IPv6 アドレスは、128 ビットを 16 ビットずつ 8 つに":" (コロン)で区切った数値列を、16 進数で表記する
    - 例 ABCD:EF01:2345:6789:ABCD:EF01:2345:6789
  - また、連続する 0 は省略が可能で、"::"は、16 ビットの 0 が複数連続していることを示す
    - FF01:0:0:0:0:0:0:101 (マルチキャストアドレス)
      - 省略型) FF01::101
    - 2001:DB8:0:0:8:800:200C:417A (ユニキャストアドレス)
      - 省略型) 2001:DB8::8:800:200C:417A
    - 0:0:0:0:0:0:0:1 (ループバックアドレス)
      - 省略型) ::1
    - 0:0:0:0:0:0:0:0 (未指定アドレス)
      - 省略型) ::
- リンクローカルアドレス
  - 同一リンク上でのみ有効なアドレスとして、リンクローカルアドレスが定義されている
  - リンクローカルアドレスの自動生成方法には以下の種類がある
    - TODO
  - ノードは、少なくとも１つのリンクローカルアドレスを持つことが規定されているため、ノードをネットワークに接続するだけで、設定なしで同一リンク上の他のノードと通信が可能になる
  - 応用
    - BGP UNNUMBERED、OSPF UNNUMBERED
      - BGP は TCP で、OSPF は OSPF で IP によって接続し、経路交換をする
      - このとき、IPv4 では、自身の IP の設定が必要なのだが、IPv6 ではリンクローカルアドレスが自動で振られているので、設定不要で他のノードと経路交換が可能になる

## ICMPv6

- TODO

## NDP(Neighbor Discovery Protocol)

- TODO

## IPv6 のアドレスの自動設定

- SLAAC + RFC8106(RFC6106)
- SLAAC + ステートレス DHCPv6
- ステートフル DHCPv6

## IPv6 とセキュリティ

- IPv6 は新しいが、IPv4 よりもセキュアである刷毛ではない
- むしろ新しく運用実績も少ないので、IPv4 よりもセキュリティについては劣るともいえる

## Nat 46/64

- TODO
- jool
- stateful
- stateless
  - 1:1 の nat
  - EAMT
  - Explicit Address Mappings Table
