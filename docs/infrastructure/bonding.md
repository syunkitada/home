# ネットワークのBonding


## サーバサイドでのBonding(チーミングとも言う)
* balance-rr (0)
    * 送信の分散：ラウンドロビンで分散
    * 受信の分散：スイッチに依存
    * スイッチの制約：スイッチで EtherChannel を構成する必要がある
* active-backup (1)
    * 送信の分散: アクティブなNICのみを利用
    * 受信の分散: アクティブなNICのみを利用
    * スイッチの制約: なし
* balance-xor (2)
    * 送信の分散：MAC アドレスに基づいたハッシュで分散
        * ルータ越しだと常に同じアダプタ
        * ハッシュのポリシーは変更できる
    * 受信の分散：スイッチに依存
    * スイッチの制約：スイッチで EtherChannel を構成する必要がある
* broadcast (3)
    * すべての送信は、すべてのNICで行われる
* 802.3ad (4)
    * 送信の分散：MAC アドレスに基づいたハッシュで分散
        * ルータ越しだと常に同じアダプタ
        * ハッシュのポリシーは変更できる
    * 受信の分散：スイッチに依存
    * スイッチの制約：スイッチで 802.3ad を構成する必要がある
* balance-tlb (5)
    * 送信の負荷分散：負荷に応じてアダプタを選択
    * 受信の負荷分散：アクティブなアダプタのみ
        * アクティブなアダプタが故障すると別のアダプタが MAC アドレスを引き継ぐ
    * スイッチの制約：なし
* balance-alb (6)
    * 送信の負荷分散：負荷に応じてアダプタを選択
    * 受信の負荷分散：負荷に応じてアダプタを選択
        * 通信相手の ARP テーブルを書き換えることでアダプタを選択（ARP ネゴシエーション）
        * ルータ越しだと常に同じアダプタ
    * スイッチの制約：なし


## リンクアグリゲーション
* 複数の物理リンクを束ねて1つの論理リンクとして扱うことのできる技術のこと
* IEEE802.3adで標準化され、CiscoではEtherChannelという用語を使用している
* 設定方法は2つ
    * スタティックにスイッチに設定する方法
    * 各スイッチポートで論理グループを作成して、LACP(Link Aggregation Control Protocol)を使用してスイッチ間でネゴシエーションして動的にONにする方法
        * LACPは、IEEE802.3adの標準プロトコル


## vPC
* Ciscoの物理的に異なる2つの物理スイッチ間をポートチャネルで接続する技術
* vPCを利用すると、STPによるブロッキングによって片方リンクを無効化する必要がなくなる
* vPC用語
    * vPC
        * vPCピアスイッチによって形成されたポートチャネル
    * vPCピアスイッチ
        * vPCプロトコルを実行し、vPCを提供するお互いの機器
    * vPCメンバポート
        * vPCを設定したvPCピアスイッチ上の物理ポート
    * vPCピアリンク
        * vPCピアスイッチ間のポートチャネル
        * vPCピアスイッチ間で同期のために使用されるリンク
        * ピアリンクを使用してローカルピアからの発信パケットとしてタグ付けする
        * 対向のvPCピアスイッチのvPCメンバーポートの障害発生時に、データトラフィックを導く
    * vPCピアキープアライブリンク
        * リモートピアが正常に動作しているかどうかを判別する"セカンダリテスト"として使用される
        * L3通信パスを提供する
        * このリンクではデータトラフィックや同期トラフィックは送信されない
    * vPCドメイン
        * vPCを構成する2台のvPCピアスイッチが所属するドメインのこと
    * Cisco Fabric Services(CFS)
        * ステートフルな設定メッセージの送受信と同期をサポートするよう設計されたプロトコル
        * vPCピアリンクでやりとりされる
        * vPCピアスイッチ間の状態の同期（MACテーブル等）を行う
